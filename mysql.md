#### MySQL日志  
*	set global general_log='on'  
*	set global log_output='table'  
*	select * from mysql.general_log\G  
*	set global general_log='off'  
*	\W  
*	explain extended select * from t1,t2\G  
*	show warnings  

#### MySQL优化查询
*	select count(*) from items where id in (select iid from items_links);--> select count(distinct items.id) from items join items_link on (items.id=items_links.iid)  
*	在与where、join和group by语句相关的列上添加索引可以加速查询，order by上添加也有效果，因为他将使服务器更高效的排序  
*	由于上面items中id字段和items_links的iid字段连接，因此应该在这两列上添加索引  
*	alter table items add index(id);

#### where字句
*	where A=:A
	and   B>:B
	and   C=:C
	>索引列A是等值谓语，很明显列A是匹配列，将被用于定义索引片  
	索引列B是一个范围，也将用于定义索引片  
	由于列B是一个范围谓词，所以剩下的列C将不能参与匹配过程——它不能定义索引片

####为什么要建索引
1. 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。 
2. 可以大大加快 数据的检索速度，这也是创建索引的最主要的原因。 
3. 可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。 
4. 在使用分组和排序 子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。 
5. 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。

####那些列创建索引
1. 对于那些在查询中很少使用或者参考的列不应该创建索引。这是因为，既然这些列很少使用到，因此有索引或者无索引，并不能提高查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。 
2. 对于那些只有很少数据值的列也不应该增加索引。这是因为，由于这些列的取值很少，例如人事表的性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比 例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度。 
3. 对于那些定义为text, image和bit数据类型的列不应该增加索引。这是因为，这些列的数据量要么相当大，要么取值很少。 
4. 当修改性能远远大于检索性能时，不应该创建索 引。这是因为，修改性能和检索性能是互相矛盾的。当增加索引时，会提高检索性能，但是会降低修改性能。当减少索引时，会提高修改性能，降低检索性能。因 此，当修改性能远远大于检索性能时，不应该创建索引。

	1. 主键自动建立唯一索引；

	2. 频繁作为查询条件的字段应该创建索引；

	3. 查询中与其他表有关联的字段，例如外键关系；

	4. 频繁更新的字段不适合创建索引，因为每次更新不单单是更新记录，还会更新索引，保存索引文件

	5. where条件里用不到的字段，不创建索引；

	6. 高并发的情况下一般选择复合索引；

	7. 查询中排序的字段创建索引将大大提高排序的速度（索引就是排序加快速查找）；

	8. 查询中统计或者分组的字段；

	9. 表记录太少，不需要创建索引；

	10. 经常增删改的表；

	11. 数据重复且分布平均的字段，因此为经常查询的和经常排序的字段建立索引。注意某些数据包含大量重复数据，因此他建立索引就没有太大的效果，例如性别字段，只有男女，不适合建立索引。

####数据库建立索引常用的规则如下：

1. 表的主键、外键必须有索引
2. 数据量超过300的表应该有索引
3. 经常与其他表进行连接的表，在连接字段上应该建立索引
4. 经常出现在Where子句中的字段，特别是大表的字段，应该建立索引
5. 索引应该建在选择性高的字段上
6. 索引应该建在小字段上，对于大的文本字段甚至超长字段，不要建索引
7. 复合索引的建立需要进行仔细分析；尽量考虑用单字段索引代替

####数据库索引类型
1. **顺序文件上的索引：**针对按指定属性值升序或降序存储的关系，在该属性上建立一个顺序索引文件，索引文件有属性值和对应的元组指针组成
2. **B+树索引：**将索引属性组织成B+树形式，B+树的叶节点为属性值和对应的元组指针。B+树索引具有动态平衡的优点
3. **散列索引：**是建立若干个桶，将索引属性按照其散列函数值映射到对应的桶中，桶中存放索引属性值和相应的元组指针。散列索引具有查找速度快的特点
4. **位图索引：**用位向量记录索引属性中可能出现的值，每个位向量对应一个可能值

### 一条语句实现
SELECT sum(case when id < 10 then 1 else 0 end),
	sum(case when id > 10 then 1 else 0 end)
FROM `t_comment`

SELECT *
FROM `t_comment` where id > 10 
union
SELECT *
FROM `t_comment` where id < 10 

### utf8和utf8mb4区别
1. mb4就是most bytes 4的意思，专门用来兼容四字节的unicode。好在utf8mb4是utf8的超集，除了将编码改为utf8mb4外不需要做其他转换。当然，为了节省空间，一般情况下使用utf8也就够了。
2. 原来mysql支持的 utf8 编码最大字符长度为 3 字节，如果遇到 4 字节的宽字符就会插入异常了。三个字节的 UTF-8 最大能编码的 Unicode 字符是 0xffff，也就是 Unicode 中的基本多文种平面(BMP)。也就是说，任何不在基本多文本平面的 Unicode字符，都无法使用 Mysql 的 utf8 字符集存储。包括 Emoji 表情(Emoji 是一种特殊的 Unicode 编码，常见于 ios 和 android 手机上)，和很多不常用的汉字，以及任何新增的 Unicode 字符等等。
3.  对于 CHAR 类型数据，utf8mb4 会多消耗一些空间，根据 Mysql 官方建议，使用 VARCHAR  替代 CHAR。

### 时间
1. date(年-月-日) 
create table test(hiredate date);
2. datetime（日期时间类型） 
create table test(hiredate datetime)
3. timestamp（邮戳类型，保存年-月-日 时-分-秒）
create table test(hiredate timestamp)